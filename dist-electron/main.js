"use strict";const r=require("electron"),i=require("path"),l=require("child_process");var d={};const{app:t,BrowserWindow:u}=r,s=i,{spawn:h}=l;let e,n=null;function m(){e=new u({width:1e3,height:800,minWidth:800,minHeight:600,webPreferences:{nodeIntegration:!1,contextIsolation:!0,webSecurity:!0},show:!1,icon:s.join(__dirname,"../public/favicon.ico")});const c="http://localhost:8000",o=()=>{e&&(console.log(`🔌 Tentando conectar a ${c}...`),e.loadURL(c).then(()=>{console.log("✅ Conectado com sucesso ao backend Eel!"),e.show()}).catch(()=>{console.log("⚠️ Falha ao conectar. Tentando novamente em 2 segundos..."),setTimeout(o,2e3)}))};o(),e.on("closed",()=>{e=null})}function w(){if(!t.isPackaged){console.log("🔧 Modo Desenvolvimento: Inicie o `app_consolidado.py` manualmente em outro terminal.");return}console.log("📦 Modo Produção: Iniciando backend_server.exe...");const o=s.join(process.resourcesPath,"backend_server.exe");n=h(o,[],{cwd:s.dirname(o)}),n.stdout.on("data",a=>console.log(`[Backend]: ${a}`)),n.stderr.on("data",a=>console.error(`[Backend ERRO]: ${a}`))}function p(){n&&(console.log("🛑 Parando backend Eel..."),n.kill())}t.whenReady().then(()=>{w(),m()});t.on("window-all-closed",()=>{process.platform!=="darwin"&&t.quit()});t.on("quit",()=>{console.log("👋 Encerrando aplicação..."),p()});module.exports=d;
